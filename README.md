# Spark_Assignment
Please follow the below instructions step by step - 
1) First please install windows 7/8/10 in your laptop / desktop to run this solution.

2) Please install jupyter notebook in your laptop / desktop for executing python script.

3) Please install PostgreSQL database management system in your laptop / desktop for executing database script with the following details - 

		a) Th hostname for the database server should be --> localhost.

		b) A database needs to be created with name --> postgres.

		c) The username to access the database should be --> postgres.

		d) The password should be same as username.

		e) The port number to connect to the database server should be --> 5432.

4) Please execute the database script "database_objects_script.sql" to create the required database objects in postgres 
database through pgAdmin. 

5) After executing the SQL script, the following objects will be created - 

		a) public.stage_matching_data --> This table will be used to store the data, extracted from json data file.

		b) public.user_details --> This table is main table and it will be used to store data, extracted from the stage table,
		which is public.stage_matching_data.

		c) public.user_matching_details --> This table will be used to store the matching data, generated by
		public.generate_matches function.

		d) public.user_rejection_details --> This table will be used to store the rejected matches, generated by
		public.reject_matches function.

		e) public.generate_matches --> This function will generate matches for each user and will populate 
		two records in public.user_matching_details table, each time when it will be executed. A parameter is 
		there for this function, which needs to be provided during this function execution as it will help to 
		check the distance between two users at the time of match comparison.

		f) public.reject_matches --> This function will generate rejection related data and will populate data 
		into public.user_rejection_details table.

		g) public.get_matches --> This function will help to fetch matching records based on a user's name 
		(user name needs to be provided as an input parameter to call this function.)

		h) public.vw_generate_matches --> This view can be used for testing purpose and it will return both matching and
		rejected data for testing.

		i) public.user_matching_details has a column called 'current_flag'. When a match record is active, 
		then it will reside in table public.user_matching_details and will have current_flag = 1. Due to the 
		value change of criteria parameters, if this record turns into a rejected record, then the value of 
		'current_flag' of that row will be moidified to 0 and it will not be visible to the end_use through 
		get_matches() function. if that record turns into a matching record again due to the changes in 
		values of criteria parameters, then again the value of 'current_flag' of that row will be moidified to 1
		and it will be visible to the end_use through get_matches() function.

		i) public.user_rejection_details has a column called 'current_flag'. When a rejected record is active, 
		then it will reside in table public.user_rejection_details and will have current_flag = 1. Due to the 
		value change of criteria parameters, if this record turns into a matching record, then the value of 
		'current_flag' of that row will be moidified to 0. if that record turns into a rejected record again 
		due to the changes in values of criteria parameters, then again the value of 'current_flag' of that row will be 			moidified to 1.

6) Create a folder "Data" in "C:\" drive and place the "data.json" data file in that folder. 

7) Open Jupyter notebook and open "Matched_Data_Extraction.ipynb" file in that and execute the python script.

8) Open postgres database and check data in public.stage_matching_data table.

9) Execute the below query to insert data from public.stage_matching_data table to public.user_details table - 

		truncate table public.user_details restart identity cascade;

		insert into public.user_details(
			display_name, age, job_title, height_in_cm, city_name, city_lat, city_lon, main_photo, pokemon_catch_rate,
			cats_owned, likes_cats, religion)
		select display_name, age, job_title, height_in_cm, city_name, city_lat, city_lon, main_photo, pokemon_catch_rate,
		cats_owned, likes_cats, religion 
			from public.stage_matching_data;

		select * from public.user_details;

		Initially I planned to create a function to insert data from public.stage_matching_data table to 
		public.user_details table by comparing the data of column "display_name" from both tables. But I found a 
		duplicate name and that 'Caroline'. No other combination was a perfect choice for data comparison to insert 
		data from stage to the main table. Perhaps an "id" key (from application) or "unique identifier" key 
		(from application) or "SSN" (social security number) or "passport number" key in the json data set for ach 
		record would be helpful.

10) Execute the function public.user_matching_details to generate the matching data.

11) Execute public.user_rejection_details function to generate the rejection data'.

12) Execute public.get_matches to fetch matching data for a person.

13) Test script is attached in this repository with the test cases and it's named as "test_script.sql"
